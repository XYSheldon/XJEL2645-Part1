<!DOCTYPE html>
<html>

<!-- Header -->

<head>
    <link rel="stylesheet" href="../css/main.css">
    <title>ELEC2645 Embedded Systems Project</title>
</head>

<!-- Body -->

<body>
    <!-- Top matter -->
    <section>
        <nav>
            <a href="../index.html">Home</a>
            <a href="https://github.com/ELEC2645">GitHub</a>
        </nav>

        <a href="http://www.leeds.ac.uk">
    <img src="../images/logo.png" alt="University of Leeds" style="float:right;width:200px;height:80px;">
    </a>
    </section>

    <!-- Title -->
    <h1>Header Guards</h1>

    <!-- Intro -->
    <section>
        <h2>Introduction</h2>
        <p>Consider the following classes.</p>
        <p><i> "Person.h" </i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;">1
2
3
4
5
6</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#include &lt;string&gt;</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
 <span style="color: #a0a000;">public:</span>
  std<span style="color: #666666;">::</span>string name;
};
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p></p>
        <p>Here we simply have a C++ string that is used to store the name of a person. The string class is part of the C++ standard library.</p>
        <p><i> "Parents.h": </i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;">1
2
3
4
5
6
7</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#include "Person.h"</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Parents</span> {
 <span style="color: #a0a000;">public:</span>
  Person father;
  Person mother;
};
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p></p>
        <p>This class is used to store a set of parents. Since a parent is a person, we use the Person class to represent each parent (meaning we can set their name). We may then use these classes in our main.cpp file.</p>
        <p><i> "main.cpp" </i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#include "Parents.h"</span>
<span style="color: #bc7a00;">#include "Person.h"</span>
<span style="color: #bc7a00;">#include &lt;iostream&gt;</span>

<span style="color: #b00040;">int</span> <span style="color: #0000ff;">main</span>() {
  Person best_friend;
  best_friend.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"John"</span>;
  std<span style="color: #666666;">::</span>cout <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">"My best friend is "</span> <span style="color: #666666;">&lt;&lt;</span> best_friend.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">".</span><span style="color: #bb6622; font-weight: bold;">\n</span><span style="color: #ba2121;">"</span>;

  Parents my_parents;
  my_parents.father.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"William"</span>;
  my_parents.mother.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"Susan"</span>;

  std<span style="color: #666666;">::</span>cout <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">"My parents are called "</span> <span style="color: #666666;">&lt;&lt;</span> my_parents.father.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">" and "</span>
            <span style="color: #666666;">&lt;&lt;</span> my_parents.mother.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">".</span><span style="color: #bb6622; font-weight: bold;">\n</span><span style="color: #ba2121;">"</span>;
  <span style="color: #008000; font-weight: bold;">return</span> <span style="color: #666666;">0</span>;
}
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p></p>
        <p>This code simply creates a Person object used to hold the details of our best friend and also creates an instance of the Parents class to hold details of our parents. Note that we must include the header files of each class in order to use them in main.cpp.</p>
    </section>

    <!-- Compilation Error -->
    <section>
        <h2>Compilation error</h2>
        <p>Although everything looks reasonable enough, this code will not compile and we get the following compiler error (exact message may vary depending on which compiler was used).</p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;">1
2
3
4
5
6
7
8
9</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span>In file included from main.<span>cpp</span></span><span style="color: #666666;">:2:</span>
Person.h<span style="color: #666666;">:6:7:</span> error<span style="color: #666666;">:</span> redefinition of <span style="border: 1px solid #FF0000;">'</span><span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span><span style="border: 1px solid #FF0000;">'</span>
 <span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
       <span style="color: #666666;">^~~~~~</span>
In file included from Parents.h<span style="color: #666666;">:6</span><span>,
                 from main.<span>cpp</span></span><span style="color: #666666;">:1:</span>
Person.h<span style="color: #666666;">:6:7:</span> note<span style="color: #666666;">:</span> previous definition of <span style="border: 1px solid #FF0000;">'</span><span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span><span style="border: 1px solid #FF0000;">'</span>
 <span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
       <span style="color: #666666;">^~~~~~</span>
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>Looking at the error message, it seems to suggest that our Person class has been defined more than once. How has this happened?</p>
    </section>

    <!-- Include -->
    <section>
        <h2>#include pre-processor directive</h2>
        <p>The #include pre-processor directive essentially copies in the contents of the file that we are including. Once the pre-processor has run, our main.cpp will look something like below.</p>
        <p><i>main.cpp</i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#include &lt;string&gt;</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
<span style="color: #a0a000;">public:</span>
  std<span style="color: #666666;">::</span>string name;
};

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Parents</span> {
<span style="color: #a0a000;">public:</span>
  Person father;
  Person mother;
};

<span style="color: #bc7a00;">#include &lt;string&gt;</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
<span style="color: #a0a000;">public:</span>
  std<span style="color: #666666;">::</span>string name;
};

<span style="color: #bc7a00;">#include &lt;iostream&gt;</span>

<span style="color: #b00040;">int</span> <span style="color: #0000ff;">main</span>() {
  Person best_friend;
  best_friend.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"John"</span>;
  std<span style="color: #666666;">::</span>cout <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">"My best friend is "</span> <span style="color: #666666;">&lt;&lt;</span> best_friend.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">".</span><span style="color: #bb6622; font-weight: bold;">\n</span><span style="color: #ba2121;">"</span>;

  Parents my_parents;
  my_parents.father.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"William"</span>;
  my_parents.mother.name <span style="color: #666666;">=</span> <span style="color: #ba2121;">"Susan"</span>;

  std<span style="color: #666666;">::</span>cout <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">"My parents are called "</span> <span style="color: #666666;">&lt;&lt;</span> my_parents.father.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">" and "</span>
  <span style="color: #666666;">&lt;&lt;</span> my_parents.mother.name <span style="color: #666666;">&lt;&lt;</span> <span style="color: #ba2121;">".</span><span style="color: #bb6622; font-weight: bold;">\n</span><span style="color: #ba2121;">"</span>;
  <span style="color: #008000; font-weight: bold;">return</span> <span style="color: #666666;">0</span>;
}
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>Since both main.cpp and Parents.h include our Person class, we can see that the definition of our Person class now appears twice! This is the cause of the compilation error. So how do we fix it?</p>
    </section>

    <!-- Header Gaurds -->
    <section>
        <h2>Header guards</h2>
        <p>We can use header guards in header files to prevent them being included multiple times.</p>
        <p><i>"Person.h"</i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#ifndef PERSON_H</span>
<span style="color: #bc7a00;">#define PERSON_H</span>

<span style="color: #bc7a00;">#include &lt;string&gt;</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Person</span> {
<span style="color: #a0a000;"> public:</span>
  std<span style="color: #666666;">::</span>string name;
};

<span style="color: #bc7a00;">#endif </span><span style="color: #408080; font-style: italic;">// PERSON_H</span>
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p><i>"Parents.h"</i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow: auto; width: auto; font-family: 'courier new', courier, monospace; border: solid gray; border-width: .1em .1em .1em .8em; padding: .2em .6em;">
            <table>
                <tbody>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%;"><span style="color: #bc7a00;">#ifndef PARENTS_H</span>
<span style="color: #bc7a00;">#define PARENTS_H</span>

<span style="color: #bc7a00;">#include "Person.h"</span>

<span style="color: #008000; font-weight: bold;">class</span> <span style="color: #0000ff; font-weight: bold;">Parents</span> {
<span style="color: #a0a000;"> public:</span>
  Person father;
  Person mother;
};

<span style="color: #bc7a00;">#endif </span><span style="color: #408080; font-style: italic;">// PARENTS_H</span>
</pre>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>The #ifndef pre-processor directive checks to see if a token has not already been defined in the code. If it has not, then the token is defined and the code between #ifndef and #endif will be included. If it has already been defined (i.e. the header has already been included elsewhere), then it is skipped and the code will not be included again. This prevents the header from appearing more than once. Note that the naming convention of the token is the file name in upper-case with an underscore instead of a full-stop and that an in-line comment is often used after #endif to remind us which #ifndef token we are closing.</p>
    </section>

    <!-- Summary -->
    <section>
        <h2>Summary</h2>
        <p>After including header guards in our header files, the code will compile successfully. When the code runs, we will see the following output in the terminal.</p>
        <p><span style="font-family: 'courier new', courier;">My best friend is John.</span></p>
        <p><span style="font-family: 'courier new', courier;">My parents are called William and Susan.</span></p>
        <p>In summary, always use header guards!</p>
    </section>

</body>

<!-- footer -->
<footer>
    <ul>
        <li> &copy Dr Craig A. Evans, 2018 </li>
        <li> <a href="mailto:C.A.Evans@leeds.ac.uk">email</a></li>
        <li> <a href="https://engineering.leeds.ac.uk/staff/347/Dr_Craig_A_Evans">webpage</a></li>
    </ul>
</footer>

</html>
