<!DOCTYPE html>
<html>

<!-- Header -->

<head>
    <link rel="stylesheet" href="../css/main.css">
    <title>ELEC2645 Embedded Systems Project</title>
</head>

<!-- Body -->

<body>
    <!-- Top matter -->
    <section>
        <nav>
            <a href="../index.html">Home</a>
            <a href="https://github.com/ELEC2645">GitHub</a>
        </nav>

        <a href="http://www.leeds.ac.uk">
    <img src="../images/logo.png" alt="University of Leeds" style="float:right;width:200px;height:80px;">
    </a>
    </section>

    <!-- Title -->
    <h1>Constructors</h1>

    <!-- Introduction -->
    <section>
        <h2>Introduction</h2>

        <p>Consider the <a href="classes.html#example">previous example</a>. What would happen if we did not use the mutator method to set the radius before using the accessor to get the area?</p>

        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <table>
                <tr>
                    <td>
                        <pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre>
                    </td>
                    <td>
                        <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#include &lt;iostream&gt;</span>
<span style="color: #BC7A00">#include &quot;Circle.h&quot;</span>

<span style="color: #B00040">int</span> <span style="color: #0000FF">main</span>() {
  Circle circle;
  <span style="color: #B00040">float</span> area <span style="color: #666666">=</span> circle.get_area();
  std<span style="color: #666666">::</span>cout <span style="color: #666666">&lt;&lt;</span> <span style="color: #BA2121">&quot;The circle has an area of &quot;</span> <span style="color: #666666">&lt;&lt;</span> area <span style="color: #666666">&lt;&lt;</span> <span style="color: #BA2121">&quot; m^2.</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>;
  <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>;
}
</pre>
                    </td>
                </tr>
            </table>
        </div>

        <p>Compiling the code using the Apple LLVM compiler, the following output would be displayed in the terminal.</p>

        <p><span style="font-family: 'courier new', courier, monospace">The circle has an area of inf m^2.</span></p>

        <p>Compiling the code using the GCC compiler, the following output would be displayed.</p>

        <p><span style="font-family: 'courier new', courier, monospace">The circle has an area of 0 m^2.</span></p>

        <p><span style="font-family: 'courier new', courier, monospace">inf</span> is the C++ equivalent of infinity and usually occurs when an operation returns a floating-point number too large to store in a floating-point variable (float or double). So why has this occurred?
    </section>

    <!-- Initialisation -->
    <section>
        <h2>Variable initialisation</h2>

        <p>The root cause of the <span style="font-family: 'courier new', courier, monospace">inf</span> in this case is because we have not initialised the <span style="font-family: 'courier new', courier, monospace">_radius</span> variable in our <a href="classes.html#example">Circle class.</a> Since the variable is uninitialised, it will essentially have a garbage value. A variable simply represents a location in memory (RAM) and there is no guarantee that the memory location will be empty. A float is 4 bytes and so the variable will essentially have a random 32-bit binary value. When this is interpreted as a floating-point number, it may end up being huge. When we calculate the area, we square this huge value, causing it to become too big to store in a float and hence returning <span style="font-family: 'courier new', courier, monospace">inf</span> (or 0 depending on the compiler). </p>

        <p>The list below shows some of the random values stored in the uninitialised radius member variable after the code (compiled using the Apple LLVM compiler) was executed several times.</p>

        <p><span style="font-family: 'courier new', courier, monospace">-5.50993e+23</span></p>
        <p><span style="font-family: 'courier new', courier, monospace">-6.83838e+21</span></p>
        <p><span style="font-family: 'courier new', courier, monospace">-5.05653e+20</span></p>
        <p><span style="font-family: 'courier new', courier, monospace">-3.00742e+27</span></p>

        <p>When the code was compiled using GCC, the same random value was output each time, suggesting that the variable was put in the same location in memory each time.</p>
    </section>

    <!-- Using a constructor -->
    <section>
        <h2>Using a constructor</h2>
        <p>When creating a class, it is therefore a good idea to ensure that all member variables are initialised. One way to do this is by using a <i>constructor</i>. A constructor is a special class method that runs when an object of that class is created. We can therefore assign member variables with <i>default</i> values in the constructor. This ensures that when the object is then subsequently used, the variables have a value.</p>
        <p>It is worth pointing out that this is not actually initialisation in the formal sense. Strictly speaking, initialisation takes place when a variable is assigned a value when it is declared i.e.</p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <pre style="margin: 0; line-height: 125%"><span style="color: #B00040">int</span> a <span style="color: #666666">=</span> <span style="color: #666666">1</span>;
</pre>
        </div>
        <p>In the case of our class, the member variables are declared in the class definition in the header file and are not actually initialised. It is only when the constructor runs that the variables are assigned a value i.e.</p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <pre style="margin: 0; line-height: 125%"><span style="color: #B00040">int</span> a;   <span style="color: #408080; font-style: italic">// declared in class definition</span>
a <span style="color: #666666">=</span> <span style="color: #666666">1</span>;   <span style="color: #408080; font-style: italic">// assigned a value in the constructor</span>
</pre>
        </div>
    </section>

    <!-- Class constructor -->
    <section>
        <h2 id="c++constructor">C++ class constructor</h2>
        <p>The example below demonstrates how to use a constructor in C++.</p>

        <p><i>Circle.h</i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <table>
                <tr>
                    <td>
                        <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre>
                    </td>
                    <td>
                        <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#ifndef CIRCLE_H</span>
<span style="color: #BC7A00">#define CIRCLE_H</span>

<span style="color: #BC7A00">#define PI 3.14159265</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Circle</span> {
 <span style="color: #A0A000">public:</span>
  Circle();                       <span style="color: #408080; font-style: italic">// constructor declaration</span>
  <span style="color: #B00040">void</span> <span style="color: #0000FF">set_radius</span>(<span style="color: #B00040">float</span> radius);  <span style="color: #408080; font-style: italic">// mutator</span>
  <span style="color: #B00040">float</span> <span style="color: #0000FF">get_area</span>();               <span style="color: #408080; font-style: italic">// accessor</span>
 <span style="color: #A0A000">private:</span>
  <span style="color: #408080; font-style: italic">// member variables are private and set/get via accessor/mutator</span>
  <span style="color: #B00040">float</span> _radius;
  <span style="color: #B00040">float</span> _area;
};

<span style="color: #BC7A00">#endif</span>
</pre>
                    </td>
                </tr>
            </table>
        </div>


        <p><i>Circle.cpp</i></p>
        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <table>
                <tr>
                    <td>
                        <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre>
                    </td>
                    <td>
                        <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#include &quot;Circle.h&quot;</span>

<span style="color: #408080; font-style: italic">// class constructor definition</span>
Circle<span style="color: #666666">::</span>Circle() {
  _radius <span style="color: #666666">=</span> <span style="color: #666666">1.0</span>;
}
<span style="color: #408080; font-style: italic">// mutator method to set radius</span>
<span style="color: #B00040">void</span> Circle<span style="color: #666666">::</span>set_radius(<span style="color: #B00040">float</span> radius) { _radius <span style="color: #666666">=</span> radius; }
<span style="color: #408080; font-style: italic">// accessor method to get area</span>
<span style="color: #B00040">float</span> Circle<span style="color: #666666">::</span>get_area() {
  _area <span style="color: #666666">=</span> PI <span style="color: #666666">*</span> _radius <span style="color: #666666">*</span> _radius;
  <span style="color: #008000; font-weight: bold">return</span> _area;
}
</pre>
                    </td>
                </tr>
            </table>
        </div>

        <p>The constructor is declared in the header file and the actual definition appears in the implementation (.cpp) file. Inside the constructor definition we then simply assign a 'default' value to radius member variable. This then assures that even if we forget to set the radius of the circle when we use the class, it will have a default value avoiding the potential issues brought about by unitialised values.</p>

    </section>

    <!-- Initialisation in class definition -->
    <section>
        <h2>Initialisation in class definition</h2>
        <p>Every few years, the C++ language is extended with new features and released as a new standard (e.g. C++98, C++11, C++14, C++17). Since C++11, it has been possible to initialise variables in the class definition. In the example below, we can assign a value to the radius member variable in the header file. The constructor in the .cpp file can then be empty of any initialisation commands.</p>

        <p><i>Circle.h</i></p>

        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <table>
                <tr>
                    <td>
                        <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre>
                    </td>
                    <td>
                        <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#ifndef CIRCLE_H</span>
<span style="color: #BC7A00">#define CIRCLE_H</span>

<span style="color: #BC7A00">#define PI 3.14159265</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Circle</span> {
 <span style="color: #A0A000">public:</span>
  Circle();                       <span style="color: #408080; font-style: italic">// constructor declaration</span>
  <span style="color: #B00040">void</span> <span style="color: #0000FF">set_radius</span>(<span style="color: #B00040">float</span> radius);  <span style="color: #408080; font-style: italic">// mutator</span>
  <span style="color: #B00040">float</span> <span style="color: #0000FF">get_area</span>();               <span style="color: #408080; font-style: italic">// accessor</span>
 <span style="color: #A0A000">private:</span>
  <span style="color: #408080; font-style: italic">// member variables are private and set/get via accessor/mutator</span>
  <span style="color: #B00040">float</span> _radius = 1.0;
  <span style="color: #B00040">float</span> _area;
};

<span style="color: #BC7A00">#endif</span>
</pre>
                    </td>
                </tr>
            </table>
        </div>

        <p>To do this, we must ensure we use C++11 (or newer). Some versions of compiler may default to C++11 (or newer), but to be safe we can explicitly tell the compiler which C++ standard to use with a compiler flag. For example, the following compiler flag will tell the compiler to use the C++11 standard. The year number can changed in the flag to select one of the other versions.</p>

        <span style="font-family: 'courier new', courier, monospace">-std=c++11</span>
    </section>


    <!-- new section -->
    <section>
        <h2>List initialisation</h2>

        <p>Another new feature introduced in C++11 is the ability to initialise member variables using lists and this is deemed to be the best practice.</p>

        <p><i>Circle.cpp</i></p>

        <!-- HTML generated using hilite.me -->
        <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
            <table>
                <tr>
                    <td>
                        <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre>
                    </td>
                    <td>
                        <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#include &quot;Circle.h&quot;</span>

<span style="color: #408080; font-style: italic">// constructor using uniform list initialisation</span>
Circle<span style="color: #666666">::</span>Circle() <span style="color: #666666">:</span> _radius{<span style="color: #666666">1.0</span>} {}
<span style="color: #408080; font-style: italic">// mutator method to set radius</span>
<span style="color: #B00040">void</span> Circle<span style="color: #666666">::</span>set_radius(<span style="color: #B00040">float</span> radius) { _radius <span style="color: #666666">=</span> radius; }
<span style="color: #408080; font-style: italic">// accessor method to get area</span>
<span style="color: #B00040">float</span> Circle<span style="color: #666666">::</span>get_area() {
  _area <span style="color: #666666">=</span> PI <span style="color: #666666">*</span> _radius <span style="color: #666666">*</span> _radius;
  <span style="color: #008000; font-weight: bold">return</span> _area;
}
</pre>
                    </td>
                </tr>
            </table>
        </div>

        <p>Here we initialise the radius member variable in the constructor implementation in the .cpp file. Note the use of the curly braces {}. The curly braces are used in <i>uniform initialisation</i>. You may sometimes see the same kind of syntax but with normal brackets (). This is an example of <i>direct initialisation</i>. The use of uniform initialisation is deemed best practice. More information can be found <a href="https://www.learncpp.com/cpp-tutorial/2-1-fundamental-variable-definition-initialization-and-assignment/"> here</a>.</p>

        <!-- new section -->
        <section>
            <h2>Specifying initialisation values</h2>
            <p>Up to this point, we have been providing default values to the Circle class in the constructor. The user can then use the <i>set_radius</i> mutator method to set the radius. This involves the user having to type two commands, first create a Circle object and then use the mutator methods.</p>
            <p>It is also possible to allow values to be passed into the constructor that enable users to create objects with specific values. An example is below.</p>

            <p><i>Circle.h</i></p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <table>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#ifndef CIRCLE_H</span>
<span style="color: #BC7A00">#define CIRCLE_H</span>

<span style="color: #BC7A00">#define PI 3.14159265</span>

<span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Circle</span> {
 <span style="color: #A0A000">public:</span>
  Circle(<span style="color: #B00040">float</span> radius);           <span style="color: #408080; font-style: italic">// constructor with value</span>
  <span style="color: #B00040">void</span> <span style="color: #0000FF">set_radius</span>(<span style="color: #B00040">float</span> radius);  <span style="color: #408080; font-style: italic">// mutator</span>
  <span style="color: #B00040">float</span> <span style="color: #0000FF">get_area</span>();               <span style="color: #408080; font-style: italic">// accessor</span>
 <span style="color: #A0A000">private:</span>
  <span style="color: #408080; font-style: italic">// member variables are private and set/get via accessor/mutator</span>
  <span style="color: #B00040">float</span> _radius;
  <span style="color: #B00040">float</span> _area;
};

<span style="color: #BC7A00">#endif</span>
</pre>
                        </td>
                    </tr>
                </table>
            </div>

            <p><i>Circle.cpp</i></p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <table>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#include &quot;Circle.h&quot;</span>

<span style="color: #408080; font-style: italic">// constructor using uniform list initialisation</span>
Circle<span style="color: #666666">::</span>Circle(<span style="color: #B00040">float</span> radius) <span style="color: #666666">:</span> _radius{radius} {}
<span style="color: #408080; font-style: italic">// mutator method to set radius</span>
<span style="color: #B00040">void</span> Circle<span style="color: #666666">::</span>set_radius(<span style="color: #B00040">float</span> radius) { _radius <span style="color: #666666">=</span> radius; }
<span style="color: #408080; font-style: italic">// accessor method to get area</span>
<span style="color: #B00040">float</span> Circle<span style="color: #666666">::</span>get_area() {
  _area <span style="color: #666666">=</span> PI <span style="color: #666666">*</span> _radius <span style="color: #666666">*</span> _radius;
  <span style="color: #008000; font-weight: bold">return</span> _area;
}
</pre>
                        </td>
                    </tr>
                </table>
            </div>

            <p><i>main.cpp</i></p>

            <!-- HTML generated using hilite.me -->
            <div style="background: #f8f8f8; overflow:auto;width:auto;font-family: 'courier new', courier, monospace;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <table>
                    <tr>
                        <td>
                            <pre style="margin: 0; line-height: 125%">1
2
3
4
5
6
7
8
9</pre>
                        </td>
                        <td>
                            <pre style="margin: 0; line-height: 125%"><span style="color: #BC7A00">#include &lt;iostream&gt;</span>
<span style="color: #BC7A00">#include &quot;Circle.h&quot;</span>

<span style="color: #B00040">int</span> <span style="color: #0000FF">main</span>() {
  Circle circle(<span style="color: #666666">2.0</span>);
  <span style="color: #B00040">float</span> area <span style="color: #666666">=</span> circle.get_area();
  std<span style="color: #666666">::</span>cout <span style="color: #666666">&lt;&lt;</span> <span style="color: #BA2121">&quot;The circle has an area of &quot;</span> <span style="color: #666666">&lt;&lt;</span> area <span style="color: #666666">&lt;&lt;</span> <span style="color: #BA2121">&quot; m^2.</span><span style="color: #BB6622; font-weight: bold">\n</span><span style="color: #BA2121">&quot;</span>;
  <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>;
}
</pre>
                        </td>
                    </tr>
                </table>
            </div>

            <p>Here the Circle constructor now has an argument that allows to user to pass in a specific value for the radius. In <i>main.cpp</i> it is then possible to pass in the desired value of radius when creating the object, meaning it can be done in one line.</p>

        </section>

        <!-- Summary -->
        <section>
            <h2>Summary</h2>
            <p>Be aware of the various ways to use constructors, especially the post-C++11 ways. This is especially important when you start pulling random code from the Internet without knowing what version of compiler it was written with! Do not be surprised when it does not work if you grab random code from different sources and then mangle it together. Even more so, do not expect anyone else to then clean up your mess!</p>
        </section>


    </section>

</body>


<!-- footer -->
<footer>
    <ul>
        <li> &copy Dr Craig A. Evans, 2018 </li>
        <li> <a href="mailto:C.A.Evans@leeds.ac.uk">email</a></li>
        <li> <a href="https://engineering.leeds.ac.uk/staff/347/Dr_Craig_A_Evans">webpage</a></li>
    </ul>
</footer>

</html>
